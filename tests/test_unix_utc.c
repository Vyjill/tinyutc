/**
 * @file tests_unix_utc.h
 * @brief Test cases for Unix timestamp to UTC time conversion.
 * @author Ulysse Moreau
 * @date 2025-05-20
 * @version 2.0
 * @license WTFPL (Do What The F*ck You Want To Public License)
 *
 * This program is free software. It comes without any warranty, to
 * the extent permitted by applicable law. You can redistribute it
 * and/or modify it under the terms of the Do What The Fuck You Want
 * To Public License, Version 2, as published by Sam Hocevar. See
 * http://www.wtfpl.net/ for more details.
 *
 */

#include <stdint.h>
#include <stdio.h>
#include <stdbool.h>
#include <string.h>

#include "..\tinyutc.h"

struct Test
{
    uint32_t ts;
    const struct TinyUTCTime utc_tm;
};

struct Test test_cases[] = {
    {649957817, {1990, 8, 6, 15, 50, 17, 0}},
    {2514519857, {2049, 9, 6, 5, 44, 17, 0}},
    {729585558, {1993, 2, 13, 6, 39, 18, 0}},
    {1521137950, {2018, 3, 15, 18, 19, 10, 0}},
    {715202369, {1992, 8, 30, 19, 19, 29, 0}},
    {1246314210, {2009, 6, 29, 22, 23, 30, 0}},
    {3902774270, {2093, 9, 2, 23, 57, 50, 0}},
    {676618714, {1991, 6, 11, 5, 38, 34, 0}},
    {4219851679, {2103, 9, 21, 21, 1, 19, 0}},
    {3933075543, {2094, 8, 19, 16, 59, 3, 0}},
    {3368136800, {2076, 9, 24, 1, 33, 20, 0}},
    {1004118961, {2001, 10, 26, 17, 56, 1, 0}},
    {3825413127, {2091, 3, 22, 14, 45, 27, 0}},
    {2531185287, {2050, 3, 18, 3, 1, 27, 0}},
    {3184787157, {2070, 12, 2, 23, 5, 57, 0}},
    {2926018617, {2062, 9, 20, 22, 56, 57, 0}},
    {4568108, {1970, 2, 22, 20, 55, 8, 0}},
    {356889352, {1981, 4, 23, 15, 55, 52, 0}},
    {1469272213, {2016, 7, 23, 11, 10, 13, 0}},
    {1598956682, {2020, 9, 1, 10, 38, 2, 0}},
    {3637408254, {2085, 4, 6, 15, 10, 54, 0}},
    {2449991494, {2047, 8, 21, 9, 11, 34, 0}},
    {1613373033, {2021, 2, 15, 7, 10, 33, 0}},
    {3669721395, {2086, 4, 15, 15, 3, 15, 0}},
    {332445536, {1980, 7, 14, 17, 58, 56, 0}},
    {694652311, {1992, 1, 5, 22, 58, 31, 0}},
    {1106588888, {2005, 1, 24, 17, 48, 8, 0}},
    {2392672616, {2045, 10, 26, 23, 16, 56, 0}},
    {1447692156, {2015, 11, 16, 16, 42, 36, 0}},
    {3209338765, {2071, 9, 13, 2, 59, 25, 0}},
    {2527656930, {2050, 2, 5, 6, 55, 30, 0}},
    {237652338, {1977, 7, 13, 14, 32, 18, 0}},
    {3050008367, {2066, 8, 26, 0, 32, 47, 0}},
    {3766207251, {2089, 5, 6, 8, 40, 51, 0}},
    {1859239080, {2028, 11, 30, 23, 18, 0, 0}},
    {1046942836, {2003, 3, 6, 9, 27, 16, 0}},
    {3462640200, {2079, 9, 22, 20, 30, 0, 0}},
    {3996176963, {2096, 8, 19, 1, 9, 23, 0}},
    {2854601733, {2060, 6, 16, 8, 55, 33, 0}},
    {3798811503, {2090, 5, 18, 17, 25, 3, 0}},
    {1770496465, {2026, 2, 7, 20, 34, 25, 0}},
    {3430379902, {2078, 9, 14, 11, 18, 22, 0}},
    {514187052, {1986, 4, 18, 5, 44, 12, 0}},
    {3654074492, {2085, 10, 16, 12, 41, 32, 0}},
    {3819336642, {2091, 1, 11, 6, 50, 42, 0}},
    {3263054981, {2073, 5, 26, 20, 9, 41, 0}},
    {2950114028, {2063, 6, 26, 20, 7, 8, 0}},
    {2982067297, {2064, 6, 30, 16, 1, 37, 0}},
    {3160415980, {2070, 2, 23, 21, 19, 40, 0}},
    {3211809824, {2071, 10, 11, 17, 23, 44, 0}},
    {3572372149, {2083, 3, 15, 21, 35, 49, 0}},
    {2031978890, {2034, 5, 23, 6, 34, 50, 0}},
    {730841834, {1993, 2, 27, 19, 37, 14, 0}},
    {484512318, {1985, 5, 9, 18, 45, 18, 0}},
    {3356848445, {2076, 5, 16, 9, 54, 5, 0}},
    {1228441479, {2008, 12, 5, 1, 44, 39, 0}},
    {2400565508, {2046, 1, 26, 7, 45, 8, 0}},
    {2276883890, {2042, 2, 24, 19, 44, 50, 0}},
    {1470951209, {2016, 8, 11, 21, 33, 29, 0}},
    {319658852, {1980, 2, 17, 18, 7, 32, 0}},
    {1998402282, {2033, 4, 29, 15, 44, 42, 0}},
    {2695328567, {2055, 5, 30, 22, 22, 47, 0}},
    {2836200796, {2059, 11, 16, 9, 33, 16, 0}},
    {1410797081, {2014, 9, 15, 16, 4, 41, 0}},
    {2638893574, {2053, 8, 15, 17, 59, 34, 0}},
    {3489726472, {2080, 8, 1, 8, 27, 52, 0}},
    {116838125, {1973, 9, 14, 7, 2, 5, 0}},
    {1727284381, {2024, 9, 25, 17, 13, 1, 0}},
    {2247782095, {2041, 3, 24, 23, 54, 55, 0}},
    {483809260, {1985, 5, 1, 15, 27, 40, 0}},
    {244927369, {1977, 10, 5, 19, 22, 49, 0}},
    {4043428872, {2098, 2, 16, 22, 41, 12, 0}},
    {3829469198, {2091, 5, 8, 13, 26, 38, 0}},
    {3462564332, {2079, 9, 21, 23, 25, 32, 0}},
    {3000171909, {2065, 1, 26, 5, 5, 9, 0}},
    {497058070, {1985, 10, 1, 23, 41, 10, 0}},
    {1983586048, {2032, 11, 9, 4, 7, 28, 0}},
    {433032282, {1983, 9, 21, 22, 44, 42, 0}},
    {3486026082, {2080, 6, 19, 12, 34, 42, 0}},
    {1787661260, {2026, 8, 25, 12, 34, 20, 0}},
    {2100570016, {2036, 7, 25, 3, 40, 16, 0}},
    {3597466821, {2083, 12, 31, 8, 20, 21, 0}},
    {2608444734, {2052, 8, 28, 7, 58, 54, 0}},
    {3521421562, {2081, 8, 3, 4, 39, 22, 0}},
    {4111903074, {2100, 4, 20, 11, 17, 54, 0}},
    {4255318785, {2104, 11, 5, 8, 59, 45, 0}},
    {1021329257, {2002, 5, 13, 22, 34, 17, 0}},
    {960214468, {2000, 6, 5, 14, 14, 28, 0}},
    {3257117124, {2073, 3, 19, 2, 45, 24, 0}},
    {418760254, {1983, 4, 9, 18, 17, 34, 0}},
    {2161625469, {2038, 7, 1, 19, 31, 9, 0}},
    {332606199, {1980, 7, 16, 14, 36, 39, 0}},
    {2614140960, {2052, 11, 2, 6, 16, 0, 0}},
    {3475002030, {2080, 2, 12, 22, 20, 30, 0}},
    {226581207, {1977, 3, 7, 11, 13, 27, 0}},
    {1873499240, {2029, 5, 15, 0, 27, 20, 0}},
    {2572437437, {2051, 7, 8, 13, 57, 17, 0}},
    {759897290, {1994, 1, 30, 2, 34, 50, 0}},
    {3609582688, {2084, 5, 19, 13, 51, 28, 0}},
    {1080294981, {2004, 3, 26, 9, 56, 21, 0}},
    {3774136795, {2089, 8, 6, 3, 19, 55, 0}},
    {3576862684, {2083, 5, 6, 20, 58, 4, 0}},
    {3802523449, {2090, 6, 30, 16, 30, 49, 0}},
    {1660507253, {2022, 8, 14, 20, 0, 53, 0}},
    {2308047559, {2043, 2, 20, 12, 19, 19, 0}},
    {371284517, {1981, 10, 7, 6, 35, 17, 0}},
    {3835300647, {2091, 7, 15, 1, 17, 27, 0}},
    {118095349, {1973, 9, 28, 20, 15, 49, 0}},
    {3565032391, {2082, 12, 20, 22, 46, 31, 0}},
    {1471502796, {2016, 8, 18, 6, 46, 36, 0}},
    {934395777, {1999, 8, 11, 18, 22, 57, 0}},
    {681753897, {1991, 8, 9, 16, 4, 57, 0}},
    {2571550218, {2051, 6, 28, 7, 30, 18, 0}},
    {2223646288, {2040, 6, 18, 15, 31, 28, 0}},
    {848566403, {1996, 11, 21, 8, 53, 23, 0}},
    {661173366, {1990, 12, 14, 11, 16, 6, 0}},
    {3025100394, {2065, 11, 10, 17, 39, 54, 0}},
    {1898410322, {2030, 2, 27, 8, 12, 2, 0}},
    {2217944123, {2040, 4, 13, 15, 35, 23, 0}},
    {2827901629, {2059, 8, 12, 8, 13, 49, 0}},
    {2886186258, {2061, 6, 16, 22, 24, 18, 0}},
    {3123568507, {2068, 12, 24, 9, 55, 7, 0}},
    {2234493670, {2040, 10, 22, 4, 41, 10, 0}},
    {72868214, {1972, 4, 23, 9, 10, 14, 0}},
    {1252551634, {2009, 9, 10, 3, 0, 34, 0}},
    {351370740, {1981, 2, 18, 18, 59, 0, 0}},
    {94355443, {1972, 12, 28, 1, 50, 43, 0}},
    {2813149690, {2059, 2, 22, 14, 28, 10, 0}},
    {4010349724, {2097, 1, 30, 2, 2, 4, 0}},
    {938818540, {1999, 10, 1, 22, 55, 40, 0}},
    {1307960182, {2011, 6, 13, 10, 16, 22, 0}},
    {3111390800, {2068, 8, 5, 11, 13, 20, 0}},
    {2282551401, {2042, 5, 1, 10, 3, 21, 0}},
    {623803109, {1989, 10, 7, 22, 38, 29, 0}},
    {1430715999, {2015, 5, 4, 5, 6, 39, 0}},
    {1230876233, {2009, 1, 2, 6, 3, 53, 0}},
    {3795561353, {2090, 4, 11, 2, 35, 53, 0}},
    {2829591665, {2059, 8, 31, 21, 41, 5, 0}},
    {1829597, {1970, 1, 22, 4, 13, 17, 0}},
    {3067251869, {2067, 3, 13, 14, 24, 29, 0}},
    {3303863317, {2074, 9, 11, 3, 48, 37, 0}},
    {1079149781, {2004, 3, 13, 3, 49, 41, 0}},
    {2980092494, {2064, 6, 7, 19, 28, 14, 0}},
    {855906509, {1997, 2, 14, 7, 48, 29, 0}},
    {1229454790, {2008, 12, 16, 19, 13, 10, 0}},
    {1274572485, {2010, 5, 22, 23, 54, 45, 0}},
    {2932813502, {2062, 12, 8, 14, 25, 2, 0}},
    {2944121435, {2063, 4, 18, 11, 30, 35, 0}},
    {798708423, {1995, 4, 24, 7, 27, 3, 0}},
    {1945972158, {2031, 8, 31, 19, 49, 18, 0}},
    {2094445584, {2036, 5, 15, 6, 26, 24, 0}},
    {2444293669, {2047, 6, 16, 10, 27, 49, 0}},
    {1169204511, {2007, 1, 19, 11, 1, 51, 0}},
    {2037398084, {2034, 7, 24, 23, 54, 44, 0}},
    {299177156, {1979, 6, 25, 16, 45, 56, 0}},
    {841839798, {1996, 9, 4, 12, 23, 18, 0}},
    {2158011688, {2038, 5, 20, 23, 41, 28, 0}},
    {2182737264, {2039, 3, 3, 3, 54, 24, 0}},
    {4078725598, {2099, 4, 1, 11, 19, 58, 0}},
    {1828378826, {2027, 12, 9, 19, 0, 26, 0}},
    {507423611, {1986, 1, 29, 23, 0, 11, 0}},
    {3938458903, {2094, 10, 21, 0, 21, 43, 0}},
    {1881641716, {2029, 8, 17, 6, 15, 16, 0}},
    {470434139, {1984, 11, 27, 20, 8, 59, 0}},
    {3141003144, {2069, 7, 14, 4, 52, 24, 0}},
    {1611190319, {2021, 1, 21, 0, 51, 59, 0}},
    {212933989, {1976, 9, 30, 12, 19, 49, 0}},
    {2858261629, {2060, 7, 28, 17, 33, 49, 0}},
    {2365609975, {2044, 12, 17, 17, 52, 55, 0}},
    {2760383520, {2057, 6, 21, 21, 12, 0, 0}},
    {805490283, {1995, 7, 11, 19, 18, 3, 0}},
    {692172993, {1991, 12, 8, 6, 16, 33, 0}},
    {3210527463, {2071, 9, 26, 21, 11, 3, 0}},
    {3521352577, {2081, 8, 2, 9, 29, 37, 0}},
    {4156113800, {2101, 9, 14, 4, 3, 20, 0}},
    {1134021419, {2005, 12, 8, 5, 56, 59, 0}},
    {2514763335, {2049, 9, 9, 1, 22, 15, 0}},
    {1526875739, {2018, 5, 21, 4, 8, 59, 0}},
    {3757836571, {2089, 1, 29, 11, 29, 31, 0}},
    {2928085156, {2062, 10, 14, 20, 59, 16, 0}},
    {2694311278, {2055, 5, 19, 3, 47, 58, 0}},
    {2588812888, {2052, 1, 14, 2, 41, 28, 0}},
    {3117102469, {2068, 10, 10, 13, 47, 49, 0}},
    {1955547278, {2031, 12, 20, 15, 34, 38, 0}},
    {3508079476, {2081, 3, 1, 18, 31, 16, 0}},
    {3085496832, {2067, 10, 10, 18, 27, 12, 0}},
    {4204302992, {2103, 3, 25, 21, 56, 32, 0}},
    {3815743343, {2090, 11, 30, 16, 42, 23, 0}},
    {1326169803, {2012, 1, 10, 4, 30, 3, 0}},
    {3665853994, {2086, 3, 1, 20, 46, 34, 0}},
    {15432500, {1970, 6, 28, 14, 48, 20, 0}},
    {2806086235, {2058, 12, 2, 20, 23, 55, 0}},
    {856469593, {1997, 2, 20, 20, 13, 13, 0}},
    {2469466687, {2048, 4, 2, 18, 58, 7, 0}},
    {1779887833, {2026, 5, 27, 13, 17, 13, 0}},
    {425147291, {1983, 6, 22, 16, 28, 11, 0}},
    {1037263200, {2002, 11, 14, 8, 40, 0, 0}},
    {1263951213, {2010, 1, 20, 1, 33, 33, 0}},
    {2936884073, {2063, 1, 24, 17, 7, 53, 0}},
    {789220956, {1995, 1, 4, 12, 2, 36, 0}},
};

bool compare_utc_structs(const struct TinyUTCTime *a, const struct TinyUTCTime *b)
{
    return (a->year == b->year && a->month == b->month && a->day == b->day &&
            a->hour == b->hour && a->minute == b->minute && a->second == b->second && a->microseconds == b->microseconds);
}

int main()
{
    struct TinyUTCTime utc_tm = {0};
    uint32_t timestamp_result = 0;
    int sucess_count = 0;

    char spacingdesc[51] = {' '};

    for (int i = 0; i < sizeof(test_cases) / sizeof(test_cases[0]); i++)
    {
        int utc_to_unix_res = tinyutc_utc_to_unix(&(test_cases[i].utc_tm), &timestamp_result);
        int unix_to_utc_res = tinyutc_unix_to_utc(&utc_tm, test_cases[i].ts);

        if (utc_to_unix_res == 0 && unix_to_utc_res == 0 && timestamp_result == test_cases[i].ts && compare_utc_structs(&utc_tm, &(test_cases[i].utc_tm)) == true)
        {
            int desclength = 3;
            int spacelength = 10 - desclength;
            memset(spacingdesc, ' ', spacelength);
            spacingdesc[spacelength] = '\0';
            spacingdesc[50] = '\0';

            printf("\033[38;5;2m\033[1m[SUCCESS]\033[39m\t Test '%03d' %s : %013u === %04d/%02d/%02d %02d:%02d:%02d (+%dus) \n", i + 1, spacingdesc, test_cases[i].ts, test_cases[i].utc_tm.year, test_cases[i].utc_tm.month, test_cases[i].utc_tm.day,
                   test_cases[i].utc_tm.hour, test_cases[i].utc_tm.minute, test_cases[i].utc_tm.second, test_cases[i].utc_tm.microseconds);

            sucess_count++;
        }
        else
        {
            printf("\033[38;5;1m\033[1m[FAILED]\033[39m\t Test '%03d' %s : %013u =/= %04d/%02d/%02d %02d:%02d:%02d (+%dus) \n", i + 1, spacingdesc, test_cases[i].ts, test_cases[i].utc_tm.year, test_cases[i].utc_tm.month, test_cases[i].utc_tm.day,
                   test_cases[i].utc_tm.hour, test_cases[i].utc_tm.minute, test_cases[i].utc_tm.second, test_cases[i].utc_tm.microseconds); // break;
        }
    }
    printf("%d/%llu tests passed.\n", sucess_count, sizeof(test_cases) / sizeof(test_cases[0]));
}
